<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Flashcard Study App</title>
    <link rel="stylesheet" href="/css/dashboard-style.css">
    <link rel="stylesheet" href="/css/profile-dropdown.css">
    <link rel="stylesheet" href="/css/fontawesome-free-6.7.2-web/css/all.min.css">
</head>
<body>
    <script>
        // Global function to close the admin panel
        function closeAdminPanel() {
            console.log('closeAdminPanel called');
            const adminModal = document.getElementById('admin-modal');
            if (adminModal) {
                adminModal.classList.add('hidden');
                console.log('Admin panel hidden via global function');
            } else {
                console.error('Admin modal element not found!');
            }
        }
        
        // Make sure the function is available in the global scope
        window.closeAdminPanel = closeAdminPanel;
    </script>
    <!-- Top Navigation Bar -->
    <div id="top-nav">
        <button id="sidebar-toggle" class="nav-btn">
            <i class="fas fa-bars"></i>
        </button>
        <div class="logo">Med Memory</div>
        <div class="nav-buttons">
            <span id="username-display" class="username-display"></span>
            <button id="overview-button">General</button>
            <button id="test-dynamic-deck-btn" style="background: #fd5e53; color: white; padding: 5px 10px; border: none; border-radius: 4px; margin-right: 10px; cursor: pointer;">Test Dynamic Deck</button>
            <button id="faq-button" aria-label="Frequently Asked Questions">Ayuda</button>
            <button id="ranking-button">Ranking</button>
            <div class="profile-dropdown">
                <button class="profile-icon" id="profile-toggle">
                    <i class="fas fa-user"></i>
                </button>
                <div class="profile-dropdown-content" style="min-width: 160px; box-shadow: 0 8px 16px rgba(0,0,0,0.2); background-color: white; border-radius: 6px;">
                    <button class="dropdown-item" id="profile-btn" style="display: block; width: 100%; padding: 10px 15px; text-align: left; border: none; color: #34495e; background: none; font-size: 14px; cursor: pointer;">Perfil</button>
                    <button class="dropdown-item" id="logout" style="display: block; width: 100%; padding: 10px 15px; text-align: left; border: none; color: #34495e; background: none; font-size: 14px; cursor: pointer;">Cerrar sesión</button>
                </div>
            </div>
        </div>
    </div>

<!-- Sidebar Section -->
<div id="sidebar">
    <h2>Mis Mazos</h2>
    <ul id="deck-list">
      <li>
        <button id="open-admin-btn" class="nav-btn">Admin Panel</button>
      </li>
      <li>
        <button id="microbiologíay-btn" class="deck-btn">
          <span class="deck-name">Microbiología</span><span class="plus">+</span>
        </button>
        <ul class="subdeck-list">
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Bacterias</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Hongos</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Parásitos</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Virus</button>
            </div>
          </li>
        </ul>
      </li>
      <li>
        <button id="patología-btn" class="deck-btn">
          <span class="deck-name">Patología</span><span class="plus">+</span>
        </button>
        <ul class="subdeck-list">
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Metabolopatías</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Inflamación</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Neoplasias</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Cardiovascular</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Respiratorio</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Digestivo</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Aparato urinario</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Aparato reproductor</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Piel</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Huesos y articulaciones</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Sistema endocrino</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Otros</button>
            </div>
          </li>
        </ul>
      </li>
      <li>
        <button id="semiología-btn" class="deck-btn">
          <span class="deck-name">Semiología</span><span class="plus">+</span>
        </button>
        <ul class="subdeck-list">
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Historía clínica</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Piel y faneras</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Cabeza y cuello</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Respiratorio</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Cardiovascular</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Digestivo</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Urinario</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Neurología</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Osteoarticular</button>
            </div>
          </li>
        </ul>
      </li>
      <li>
        <button id="farmacología-btn" class="deck-btn">
          <span class="deck-name">Farmacología</span><span class="plus">+</span>
        </button>
        <ul class="subdeck-list">
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">ERA1</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">ERA2</button>
            </div>
          </li>
        </ul>
      </li>
      <li>
        <button id="terapéutica1-btn" class="deck-btn">
          <span class="deck-name">Terapéutica 1</span><span class="plus">+</span>
        </button>
        <ul class="subdeck-list">
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">ERA1</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">ERA2</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">ERA3</button>
            </div>
          </li>
        </ul>
      </li>
      <li>
        <button id="medicinainterna1-btn" class="deck-btn">
          <span class="deck-name">Medicina Interna 1</span><span class="plus">+</span>
        </button>
        <ul class="subdeck-list">
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Neumonología</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Cardiovascular</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Tubo Digestivo</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Neurología</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Anexos</button>
            </div>
          </li>
        </ul>
      </li>
      <li>
        <button id="revalida-btn" class="deck-btn">
          <span class="deck-name">Revalida <span class="soon-label">(en breve!)</span></span><span class="plus">+</span>
        </button>
        <ul class="subdeck-list">
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Bling</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Blang</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Blong</button>
            </div>
          </li>
        </ul>
      </li>
      <li>
        <button id="mir-btn" class="deck-btn">
          <span class="deck-name">MIR <span class="soon-label">(en breve!)</span></span><span class="plus">+</span>
        </button>
        <ul class="subdeck-list">
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Bling</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Blang</button>
            </div>
          </li>
          <li>
            <div class="subdeck-btn-wrapper">
              <button class="subdeck-btn">Blong</button>
            </div>
          </li>
        </ul>
      </li>
    </ul>
    <div class="sidebar-footer">
      <a href="https://wa.me/+55479igyggg36792" target="_blank" class="social-icon">
        <i class="fab fa-whatsapp"></i>
      </a>
      <a href="https://inslknknknkmk/medmemory.ar" target="_blank" class="social-icon">
        <i class="fab fa-instagram"></i>
      </a>
      <a href="mailto:medmevhvuygmory@outlook.com" class="social-icon">
        <i class="fas fa-envelope"></i>
      </a>
    </div>
  </div>

<!-- Main Content Section -->
<div id="main-content">
    <!-- Three Column Container -->
    <div class="stats-container">
        <!-- Left Column - Stats Panel -->
        <div id="stats-panel">
            <h2>Your Stats</h2>
            <div class="stat-item">
                <i class="fas fa-eye"></i>
                <div class="stat-content">
                    <div class="stat-value">42</div>
                    <div class="stat-label">Cards Viewed Today</div>
                </div>
            </div>
            <div class="stat-item">
                <i class="fas fa-fire"></i>
                <div class="stat-content">
                    <div class="stat-value">7</div>
                    <div class="stat-label">Current Streak</div>
                </div>
            </div>
            <div class="stat-item">
                <i class="fas fa-trophy"></i>
                <div class="stat-content">
                    <div class="stat-value">14</div>
                    <div class="stat-label">Longest Streak</div>
                </div>
            </div>
            <div class="stat-item">
                <i class="fas fa-award"></i>
                <div class="stat-content">
                    <div class="stat-value">108</div>
                    <div class="stat-label">Record Cards in a Day</div>
                </div>
            </div>
        </div>

        <!-- Middle Column - Overview Table -->
        <div class="main-content-column">
            <div id="overview-section">
                <table>
                    <thead>
                        <tr>
                            <th>Mazo</th>
                            <th>Nuevas</th>
                            <th>Pendientes</th>
                        </tr>
                    </thead>
                    <tbody id="overview-table-body">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Right Column - Notes Section -->
        <div class="notes-column">
            <div class="notes-section">
                <h3>Study Notes <i class="fas fa-pencil-alt"></i></h3>
                <textarea class="notes-textarea" placeholder="Write your notes here...
                
• Use bullet points
• Add diagrams
• Track important concepts"></textarea>
            </div>
        </div>
    </div> 

    <div id="admin-modal" class="admin-modal hidden">
        <div class="admin-modal-content">
            <button class="admin-close-btn" style="position: absolute; top: 10px; right: 15px; font-size: 24px; font-weight: bold; cursor: pointer; color: #333; padding: 5px 10px; border-radius: 4px; transition: all 0.2s ease; background: none; border: 1px solid #ddd;" onclick="closeAdminPanel();">&times;</button>
            <h2>Admin Panel</h2>
            <div class="admin-form-container">
                <form id="add-flashcard-form">
                    <div class="form-columns">
                        <div class="form-column form-column-left">
                            <div class="form-group">
                                <label for="questionInput">Content:</label>
                                <textarea id="questionInput" required placeholder="For Classic Cards:
Question on first line
Subtitle on second line (optional)
Answer on third line and beyond
Use /note for additional information

For Multiple Choice:
Question on first line
Option 1
Option 2
Option 3
Option 4
Correct: Option 3 (use exact text of the option)
Explanation: Additional details (optional)"></textarea>
                            </div>
                        </div>
                        
                        <div class="form-column form-column-middle">
                            <div class="form-group">
                                <label for="deckSelect">Deck:</label>
                                <select id="deckSelect" class="form-control" required>
                                    <option value="" disabled selected>Select a deck</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="subdeckSelect">Subdeck:</label>
                                <select id="subdeckSelect" class="form-control" required>
                                    <option value="" disabled selected>Select deck first</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="subsubdeckSelect">Subsubdeck (optional):</label>
                                <select id="subsubdeckSelect" class="form-control">
                                    <option value="" disabled selected>Select subdeck first</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="tagsInput">Tags (comma-separated):</label>
                                <input type="text" class="form-control" id="tagsInput" placeholder="Enter tags, separated by commas">
                            </div>

                            <div class="form-group">
                                <label>Card Type:</label>
                                <div class="form-check" style="display: flex; align-items: center; margin-bottom: 8px; padding: 8px; border-radius: 4px; background-color: #f8f9fa;">
                                    <input class="form-check-input" type="radio" name="cardType" id="classicCardType" value="classic" checked style="margin-right: 10px; width: 18px; height: 18px;">
                                    <label class="form-check-label" for="classicCardType" style="margin: 0; font-weight: 500; cursor: pointer;">
                                        Classic (Question/Answer)
                                    </label>
                                </div>
                                <div class="form-check" style="display: flex; align-items: center; margin-bottom: 8px; padding: 8px; border-radius: 4px; background-color: #f8f9fa;">
                                    <input class="form-check-input" type="radio" name="cardType" id="multipleChoiceCardType" value="multipleChoice" style="margin-right: 10px; width: 18px; height: 18px;">
                                    <label class="form-check-label" for="multipleChoiceCardType" style="margin: 0; font-weight: 500; cursor: pointer;">
                                        Multiple Choice
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-column form-column-preview">
                            <div class="preview-section">
                                <h3>Live Preview</h3>
                                <div class="preview-buttons">
                                    <button type="button" id="expand-preview-btn" class="btn btn-preview">Show All Cards</button>
                                </div>
                                <div class="card-preview">
                                    <!-- Card preview will be dynamically generated here -->
                                </div>
                                <div class="expanded-preview">
                                    <!-- Multiple card previews will be shown here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" id="addCardSubmit">Add Card</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Preview overlay for fullscreen mode -->
    <div class="preview-overlay"></div>
    
    <!-- Fixed position close buttons for expanded preview -->
    <button id="preview-close-x" style="display: none; position: fixed; top: 20px; right: 20px; width: 60px; height: 60px; background-color: #ff3b30; color: white; border: 3px solid white; border-radius: 50%; font-size: 40px; line-height: 50px; text-align: center; cursor: pointer; z-index: 10000; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">&times;</button>
    
    <button id="preview-return-btn" style="display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 15px 30px; background-color: #007aff; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; z-index: 10000; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">Return to Admin Panel</button>

    <h3>Calendario de Estudio</h3>

    <!-- Calendar Section -->
    <div id="study-calendar">
        <div class="calendar-header">
            <span class="month-year"></span>
        </div>
    </div>

    <!-- Flashcard Section -->
    <div id="flashcard-system" class="hidden">
        <!-- Card Status -->
        <div id="card-status">
            <span id="status"></span>
        </div>
    </div>

    <script src="/js/dashboard-script.js"></script>
    <script src="/js/profile-dropdown.js"></script>
    
    <script>
        // Close admin panel when clicking outside the modal content
        document.addEventListener('DOMContentLoaded', function() {
            const adminModal = document.getElementById('admin-modal');
            const adminModalContent = document.querySelector('.admin-modal-content');
            
            if (adminModal && adminModalContent) {
                adminModal.addEventListener('click', function(event) {
                    // If the click is directly on the modal background (not on any of its children)
                    if (event.target === adminModal) {
                        closeAdminPanel();
                    }
                });
                
                // Ensure the X button works by adding a direct event listener
                const closeBtn = document.querySelector('.admin-close-btn');
                if (closeBtn) {
                    closeBtn.addEventListener('click', function() {
                        closeAdminPanel();
                    });
                }
                
                // Add Escape key support
                document.addEventListener('keydown', function(event) {
                    if (event.key === 'Escape' && !adminModal.classList.contains('hidden')) {
                        closeAdminPanel();
                    }
                });
            }
        });
    </script>
</body>
</html>
